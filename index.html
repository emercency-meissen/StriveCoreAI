<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>StriveCore AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto;
      background: #000;
      color: #fff;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      background: #000;
      color: #fff;
      padding: 14px;
      text-align: center;
      font-weight: 700;
      position: relative;
      border-bottom: 1px solid #222;
    }
    #emergency {
      position: absolute;
      right: 12px;
      top: 10px;
      background: red;
      color: #fff;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    #chat {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .message {
      max-width: 80%;
      padding: 12px 14px;
      border-radius: 14px;
      line-height: 1.4;
      font-size: 15px;
      word-wrap: break-word;
    }
    .user {
      align-self: flex-end;
      background: #fff;
      color: #000;
    }
    .ai {
      align-self: flex-start;
      background: #111;
      color: #fff;
    }
    footer {
      display: flex;
      gap: 8px;
      padding: 10px;
      border-top: 1px solid #222;
      background: #000;
    }
    input {
      flex: 1;
      padding: 12px 14px;
      border-radius: 20px;
      border: 1px solid #444;
      background: #000;
      color: #fff;
      font-size: 15px;
      outline: none;
    }
    button {
      padding: 12px 16px;
      border-radius: 20px;
      border: 1px solid #fff;
      background: #fff;
      color: #000;
      font-size: 15px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<header>
  StriveCore AI
  <button id="emergency">EMERGENCY STOP</button>
</header>

<div id="chat">
  <div class="message ai">
    Hallo ðŸ‘‹ Ich bin <b>StriveCore AI</b>. Schreib mir etwas.
  </div>
</div>

<footer>
  <input id="input" type="text" placeholder="Nachricht schreibenâ€¦" />
  <button id="send">Senden</button>
</footer>

<script>
let emergency = false;

const input = document.getElementById('input');
const sendBtn = document.getElementById('send');
const chat = document.getElementById('chat');
const emergencyBtn = document.getElementById('emergency');

function addMessage(text, type) {
  const div = document.createElement('div');
  div.className = 'message ' + type;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function clearChat() {
  chat.innerHTML = '';
}

// ðŸ§  LOKALE INTELLIGENZ (MATHE + SPRACHEN)
function smartReply(text) {
  const tl = text.toLowerCase().trim();

  // MATHE (beliebig groÃŸ)
  const math = tl.match(/^(\d+)\s*([+\-*/])\s*(\d+)$/);
  if (math) {
    const a = BigInt(math[1]);
    const b = BigInt(math[3]);
    const op = math[2];
    let r;
    if (op === '+') r = a + b;
    if (op === '-') r = a - b;
    if (op === '*') r = a * b;
    if (op === '/') r = b !== 0n ? a / b : 'Division durch 0';
    return `ðŸ§® ${a} ${op} ${b} = ${r}`;
  }

  if (tl.includes('hallo')) return 'Hallo ðŸ‘‹ Wie kann ich dir helfen?';
  if (tl.includes('hello')) return 'Hello ðŸ‘‹ How can I help you?';
  if (tl.includes('bonjour')) return 'Bonjour ðŸ‘‹ Comment puis-je aider ?';
  if (tl.includes('hola')) return 'Hola ðŸ‘‹ Â¿En quÃ© puedo ayudarte?';

  return null; // wichtig!
}

// ðŸŒ ONLINE + FALLBACK (SAUBER)
async function sendMessage() {
  if (emergency) return;

  const text = input.value.trim();
  if (!text) return;

  addMessage(text, 'user');
  input.value = '';

  // 1ï¸âƒ£ Erst lokal prÃ¼fen (Mathe etc.)
  const local = smartReply(text);
  if (local) {
    addMessage(local, 'ai');
    return;
  }

  // 2ï¸âƒ£ Online KI
  try {
    const res = await fetch('https://strivecoreai.onrender.com', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: text })
    });

    if (!res.ok) throw new Error();

    const data = await res.json();
    addMessage(data.reply, 'ai');

  } catch {
    addMessage('âš ï¸ Offline-Modus aktiv', 'ai');
    addMessage('ðŸ¤– Ich kann gerade nur lokal antworten.', 'ai');
  }
}

// EVENTS
sendBtn.addEventListener('click', sendMessage);
input.addEventListener('keydown', e => {
  if (e.key === 'Enter') {
    e.preventDefault();
    sendMessage();
  }
});

// EMERGENCY
emergencyBtn.addEventListener('click', () => {
  emergency = true;
  addMessage('ðŸš¨ EMERGENCY STOP', 'ai');
});

// SHORTCUTS
window.addEventListener('keydown', e => {
  if (e.ctrlKey && e.key.toLowerCase() === 'v') {
    emergency = true;
    addMessage('ðŸš¨ EMERGENCY STOP', 'ai');
  }
  if (e.ctrlKey && e.key.toLowerCase() === 'b') {
    emergency = false;
    clearChat();
  }
});
</script>

</body>
</html>
